generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model Account {
  id                    String    @id @default(cuid())
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("account")
}

enum Role {
  INTERN
  ORGANIZATION
  ADMIN
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?

  @@unique([token])
  @@map("session")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  role          Role     @default(INTERN)
  name          String?
  image         String?
  emailVerified Boolean?

  accounts Account[]
  sessions Session[]

  internProfile       InternProfile?
  organizationProfile OrganizationProfile?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now()) @updatedAt

  @@map("user")
}

model InternProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  firstName      String
  lastName       String
  university     String
  major          String?
  skills         String?
  bio            String?
  phone          String?
  linkedin       String?
  github         String?
  portfolio      String?
  location       String?
  graduationYear String?
  gpa            Float?
  experience     String?
  resume         String?

  applications       Application[]
  taskProgress       TaskProgress[]
  internshipProgress InternshipProgress[]
  taskSubmissions    TaskSubmission[]

  @@map("intern_profile")
}

model OrganizationProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  organizationName String
  contactFirstName String
  contactLastName  String
  jobTitle         String
  industry         String?
  companySize      String?
  website          String?
  location         String
  description      String
  internshipGoals  String?

  internships     Internship[]
  taskEvaluations TaskEvaluation[]

  @@map("organization_profile")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

enum InternshipType {
  PAID
  UNPAID
  STIPEND
}

model Internship {
  id           String         @id @default(cuid())
  slug         String         @unique
  title        String
  description  String
  duration     String
  type         InternshipType
  amount       Int?
  rating       Int?
  feedback     String?
  location     String
  requirements String?
  deadline     DateTime
  skills       String[]
  published    Boolean        @default(false)
  approved     Boolean        @default(false)

  organizationId     String
  organization       OrganizationProfile  @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  tasks              Task[]
  applications       Application[]
  internshipProgress InternshipProgress[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("internships")
}

model Task {
  id                     String  @id @default(cuid())
  slug                   String  @unique
  title                  String
  overview               String
  background             String?
  videoUrl               String?
  description            String
  instructions           String
  submissionInstructions String
  submitAsFile           Boolean @default(false)
  submitAsText           Boolean @default(false)
  submitAsUrl            Boolean @default(false)

  internshipId    String
  internship      Internship       @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  resources       Resource[]
  taskProgress    TaskProgress[]
  taskSubmissions TaskSubmission[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tasks")
}

enum ResourceType {
  FILE
  URL
}

model Resource {
  id          String       @id @default(cuid())
  name        String
  url         String?
  file        String?
  description String?
  type        ResourceType

  taskId String
  task   Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("resources")
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
}

model Application {
  id           String            @id @default(cuid())
  internId     String
  intern       InternProfile     @relation(fields: [internId], references: [id], onDelete: Cascade)
  internshipId String
  internship   Internship        @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  coverLetter  String?
  resume       String?
  availability String?
  status       ApplicationStatus @default(PENDING)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  @@unique([internId, internshipId])
  @@map("applications")
}

model InternshipProgress {
  id           String           @id @default(cuid())
  internId     String
  internshipId String
  progress     Float            @default(0) // 0 - 100 (%)
  status       InternshipStatus @default(IN_PROGRESS)
  startedAt    DateTime         @default(now())
  completedAt  DateTime?

  intern     InternProfile @relation(fields: [internId], references: [id])
  internship Internship    @relation(fields: [internshipId], references: [id])

  @@unique([internId, internshipId])
  @@map("internship_progress")
}

enum InternshipStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

model TaskProgress {
  id          String     @id @default(cuid())
  taskId      String
  internId    String
  status      TaskStatus @default(NOT_STARTED)
  startedAt   DateTime?
  completedAt DateTime?

  task   Task          @relation(fields: [taskId], references: [id])
  intern InternProfile @relation(fields: [internId], references: [id])

  @@unique([taskId, internId])
  @@map("task_progress")
}

enum TaskStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

model TaskSubmission {
  id          String   @id @default(cuid())
  taskId      String
  internId    String
  submittedAt DateTime @default(now())

  textContent String?
  fileUrl     String?
  url         String?

  status SubmissionStatus @default(SUBMITTED)

  task       Task            @relation(fields: [taskId], references: [id])
  intern     InternProfile   @relation(fields: [internId], references: [id])
  evaluation TaskEvaluation?

  @@unique([taskId, internId])
  @@map("task_submissions")
}

model TaskEvaluation {
  id               String   @id @default(cuid())
  taskSubmissionId String   @unique
  organizationId   String
  score            Int
  feedback         String?
  evaluatedAt      DateTime @default(now())

  taskSubmission TaskSubmission      @relation(fields: [taskSubmissionId], references: [id], onDelete: Cascade)
  organization   OrganizationProfile @relation(fields: [organizationId], references: [id])

  @@map("task_evaluations")
}

enum SubmissionStatus {
  SUBMITTED
  UNDER_REVIEW
  NEEDS_REVISION
  ACCEPTED
  REJECTED
}
